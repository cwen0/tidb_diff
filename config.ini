[diff]
; src.instance = mysql://root@127.0.0.1:4000
; dst.instance = mysql://root@127.0.0.1:4000
dbs = db_%
ignore_tables = tmp_log, sys_history
threshold = 0
output = diff_result.csv

# 对比内容：rows(逐表行数), tables(库级表数), indexes(库级索引数), views(库级视图数)
# 留空或不填则默认全部启用
compare = rows,tables,indexes,views

# 数据库级别并发数（同时处理多个数据库）
# 多库场景默认值：5（针对多库场景优化）
# 建议根据数据库数量和服务器性能调整，范围 3-20
# - 少量库（<10）：3-5
# - 中等库（10-50）：5-10
# - 大量库（>50）：10-20
# 注意：每个数据库需要 2 个连接池（源+目标），请确保 max_open_conns 足够
concurrency = 5

# 是否使用统计信息快速获取行数（默认 true，速度快但可能不够精确）
# 设置为 false 时使用精确 COUNT(1)，支持表级别并发
use_stats = false

# 表级别并发数（仅在使用精确 COUNT 时有效，每个表独立并发统计）
# 多库多表场景默认值：30（针对大量表优化）
# 建议根据数据库连接数和服务器性能调整，范围 10-50
# - 少量表（<100）：10-20
# - 中等表（100-500）：20-30
# - 大量表（500-1000）：30-40
# - 超大量表（>1000）：40-50
# 注意：每个数据库的源库和目标库会并行执行，实际并发 = table_concurrency * 2
table_concurrency = 30

# 连接池配置（针对多库多表大表场景优化）
# max_open_conns: 最大打开连接数
# 如果未配置，将根据 concurrency 和 table_concurrency 自动计算：
#   公式：concurrency * 2 * (table_concurrency + 10)
#   范围：100-500（自动限制）
# 手动配置建议：
# - 少量库表：100-150
# - 中等库表：150-250
# - 大量库表：250-400
# - 超大量库表：400-500
# 注意：每个数据库需要 2 个连接池（源+目标），请确保连接数足够
max_open_conns = 0

# max_idle_conns: 最大空闲连接数
# 如果未配置，将自动计算为 max_open_conns 的 80%（最小 80）
# 保持连接池热状态，减少连接建立开销
max_idle_conns = 0

# conn_max_lifetime_minutes: 连接最大生存时间（分钟），大表场景默认 30 分钟
# 设置为 0 表示不限制连接生存时间（不推荐，可能导致使用过期连接）
# 对于超大表查询，建议设置为 30-60 分钟，避免连接在长时间查询过程中过期
conn_max_lifetime_minutes = 30

# query_timeout_seconds: 单个查询超时时间（秒），0 表示使用默认值（30分钟）
# 对于超大表 COUNT(1) 查询，可能需要较长时间，建议根据表大小设置
# 例如：千万级表建议 600-1800 秒（10-30分钟），亿级表建议 1800-3600 秒（30-60分钟）
# 设置为 0 时，默认使用 30 分钟超时
query_timeout_seconds = 0

# read_timeout_seconds: 读取超时时间（秒），0 表示使用默认值
# 针对大表查询，建议设置为 query_timeout_seconds + 60，确保有足够时间读取数据
read_timeout_seconds = 0

# write_timeout_seconds: 写入超时时间（秒），0 表示使用默认值
# 通常设置为 30-60 秒即可
write_timeout_seconds = 0

# max_retries: 查询重试次数（针对大表查询失败场景）
# 默认 2 次，范围 0-5
# 对于网络不稳定的环境，可以设置为 3-5
max_retries = 2

# 可选 snapshot_ts（TiDB）
# src.snapshot_ts = 462796050923520000
# dst.snapshot_ts = 462796051305201667